{% extends "base.html" %}
{% set title = "Help & Documentation" %}

{% block content %}
<div class="container py-4">
  <h1>Help & Documentation</h1>

  <div class="alert alert-info">
    <h5><i class="bi bi-info-circle"></i> Quick Start</h5>
    <p>This CMS helps you create websites using reusable template blocks. Each page is built from multiple blocks that can be customized individually.</p>
  </div>

  <h3 class="mt-4">Templates Overview</h3>
  <p>Templates are reusable HTML blocks stored in the database. They can be:</p>
  <ul>
    <li><strong>System</strong>: page structure (head, meta, header close/body open, body close)</li>
    <li><strong>Content</strong>: visible content sections (hero, menu, section, paragraph, etc.)</li>
  </ul>

  <h3 class="mt-4">Page Management</h3>
  <div class="row">
    <div class="col-md-6">
      <h5>Creating Pages</h5>
      <ul>
        <li>Click <strong>"Add Page"</strong> from the Pages section</li>
        <li>Enter page title and slug (URL-friendly identifier)</li>
        <li>New pages get all <strong>default</strong> page templates in the current order</li>
        <li>Pages are created as drafts by default</li>
      </ul>
    </div>
    <div class="col-md-6">
      <h5>Page Properties</h5>
      <ul>
        <li><strong>Edit Title & Slug</strong>: Modify directly in the "Page Information" section</li>
        <li><strong>Auto-slug Generation</strong>: Slugs are automatically created from titles</li>
        <li><strong>Unique Slugs</strong>: System prevents duplicate page slugs</li>
        <li><strong>Duplicate Pages</strong>: Use the "Duplicate" button to copy existing pages</li>
      </ul>
    </div>
  </div>

  <h3 class="mt-4">Page Templates & Blocks</h3>
  <ul>
    <li>On Edit Page, you can <strong>reorder blocks</strong> using drag and drop or up/down arrows</li>
    <li>Each block has <strong>"Use default"</strong> to either use the template's content or a page-specific override</li>
    <li><strong>System blocks</strong> are hidden by default but can be shown with the toggle button</li>
    <li><strong>Block indentation</strong> can be controlled using CMS tags in block captions</li>
  </ul>


  <h3 class="mt-4">Template Order</h3>
  <ul>
    <li>Templates tab lists all templates; you can reorder default order.</li>
    <li>Reordering templates changes defaults. You may optionally reorder existing pages’ blocks to match.</li>
    <li>Page editor also allows per-item ordering that overrides defaults.</li>
  </ul>

  <h3 class="mt-4">Overrides and Defaults</h3>
  <ul>
    <li>“Use default” means the block uses content from the template record.</li>
    <li>Unchecking “Use default” enables a custom override stored for that page/post only.</li>
    <li>Switching back to default restores the template content.</li>
  </ul>

  <h3 class="mt-4">Import/Export</h3>
  <ul>
    <li>Pages and Templates can be exported/imported as JSON.</li>
    <li>Export supports selecting specific items; Import supports overwrite.</li>
  </ul>

  <h3 class="mt-4">Media</h3>
  <ul>
    <li>Upload images; small/medium/large variants are created based on settings.</li>
    <li>Hover an image to copy a ready-made <code>&lt;img&gt;</code> tag for any size.</li>
  </ul>

  <hr class="my-5">

  <h2 class="mt-5">Advanced Features</h2>

  <h3 class="mt-4">Block Reordering</h3>
  <div class="row">
    <div class="col-md-6">
      <h5>Drag and Drop</h5>
      <ul>
        <li>Click and hold the <strong>grip icon</strong> (⋮⋮) on any block</li>
        <li>Drag the block to your desired position</li>
        <li>Release to place the block in the new location</li>
        <li>Smooth animations provide visual feedback during reordering</li>
      </ul>
    </div>
    <div class="col-md-6">
      <h5>Up/Down Arrows</h5>
      <ul>
        <li>Use the <strong>up/down arrow buttons</strong> for precise positioning</li>
        <li>Works alongside drag and drop functionality</li>
        <li>Perfect for fine-tuning block order</li>
        <li>Changes are saved automatically when you submit the form</li>
      </ul>
    </div>
  </div>

  <h3 class="mt-4">CMS Block Indentation</h3>
  <p>Organize your page blocks visually using CMS tags in block captions:</p>
  
  <div class="alert alert-light">
    <h6><strong>How it works:</strong></h6>
    <ul class="mb-0">
      <li>Add <code>&lt;cms:section-name&gt;</code> to a block caption to open a section</li>
      <li>All blocks after this will be indented by 50px</li>
      <li>Add <code>&lt;/cms:section-name&gt;</code> to close the section</li>
      <li>Blocks with tags act as section boundaries and are not indented themselves</li>
    </ul>
  </div>

  <h5>Example:</h5>
  <pre><code>Block 1: "Header &lt;cms:hero&gt;"      → Opens hero section (not indented)
Block 2: "Content"                → Indented 50px (inside hero)
Block 3: "More Content"           → Indented 50px (inside hero)
Block 4: "Footer &lt;/cms:hero&gt;"     → Closes hero section (not indented)
Block 5: "Normal content"         → Back to normal level</code></pre>

  <h3 class="mt-4">Parameter Types</h3>
  <p>Template parameters can have different input types for enhanced editing:</p>

  <div class="row">
    <div class="col-md-4">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="card-title"><span class="badge bg-primary">Text</span> Plain Text</h6>
          <p class="card-text small">Default parameter type for regular text content.</p>
          <code>{{ "{{slogan}}" }}</code><br>
          <code>{{ "{{title:text}}" }}</code>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="card-title"><span class="badge bg-warning">Code</span> Code Editor</h6>
          <p class="card-text small">Syntax highlighting for HTML, CSS, and JavaScript code.</p>
          <code>{{ "{{html:code}}" }}</code><br>
          <code>{{ "{{css:code}}" }}</code>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="card-title"><span class="badge bg-info">WYSIWYG</span> Rich Text</h6>
          <p class="card-text small">Full-featured Quill editor with formatting toolbar, links, lists, and more.</p>
          <code>{{ "{{content:wysiwyg}}" }}</code><br>
          <code>{{ "{{description:wysiwyg}}" }}</code>
        </div>
      </div>
    </div>
  </div>

  <h3 class="mt-4">Shortcode Cheatsheet</h3>
  <p>Quick reference for all available shortcodes and tokens:</p>
  
  <div class="row">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0"><i class="bi bi-file-text"></i> Page Tokens</h6>
        </div>
        <div class="card-body">
          <table class="table table-sm">
            <tr><td><code>{{ "{{page:title}}" }}</code></td><td>Current page title</td></tr>
            <tr><td><code>{{ "{{page:excerpt}}" }}</code></td><td>Current page excerpt (blog pages)</td></tr>
            <tr><td><code>{{ "{{page:featured:png}}" }}</code></td><td>Featured PNG image URL</td></tr>
            <tr><td><code>{{ "{{page:featured:webp}}" }}</code></td><td>Featured WebP image URL</td></tr>
          </table>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0"><i class="bi bi-journal-text"></i> Blog Tokens</h6>
        </div>
        <div class="card-body">
          <table class="table table-sm">
            <tr><td><code>{{ "{{blog:categories}}" }}</code></td><td>All blog categories list</td></tr>
            <tr><td><code>{{ "{{blog:latest}}" }}</code></td><td>Latest published posts with featured images</td></tr>
            <tr><td><code>{{ "{{blog:category:123}}" }}</code></td><td>Posts in category ID 123</td></tr>
            <tr><td><code>{{ "{{blog:category:[123]}}" }}</code></td><td>Posts in category ID 123 (bracket syntax)</td></tr>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-3">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0"><i class="bi bi-code-square"></i> Conditionals</h6>
        </div>
        <div class="card-body">
          <table class="table table-sm">
            <tr><td><code>{{ "{{if page:featured}}" }}</code></td><td>True if featured image exists</td></tr>
            <tr><td><code>{{ "{{if page:excerpt}}" }}</code></td><td>True if excerpt is set</td></tr>
            <tr><td><code>{{ "{{if page:title}}" }}</code></td><td>True if title is non-empty</td></tr>
          </table>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0"><i class="bi bi-gear"></i> Parameters & Config</h6>
        </div>
        <div class="card-body">
          <table class="table table-sm">
            <tr><td><code>{{ "{{paramName}}" }}</code></td><td>Plain text parameter</td></tr>
            <tr><td><code>{{ "{{paramName:text}}" }}</code></td><td>Explicit text parameter</td></tr>
            <tr><td><code>{{ "{{paramName:code}}" }}</code></td><td>Code editor parameter</td></tr>
            <tr><td><code>{{ "{{paramName:wysiwyg}}" }}</code></td><td>Rich text parameter</td></tr>
            <tr><td><code>{{ "{{config:base_url}}" }}</code></td><td>Site base URL from settings</td></tr>
          </table>
        </div>
      </div>
    </div>
  </div>

  <h3 class="mt-4">Special Tokens</h3>
  <p>Use these special tokens in any template block content to pull dynamic values from the current page or blog:</p>
  <div class="row">
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="card-title">Page Tokens</h6>
          <ul class="small">
            <li><code>{{ "{{page:title}}" }}</code> — Inserts the current page title</li>
            <li><code>{{ "{{page:excerpt}}" }}</code> — Inserts the current page excerpt (for blog pages)</li>
            <li><code>{{ "{{page:featured:png}}" }}</code> — URL to featured PNG</li>
            <li><code>{{ "{{page:featured:webp}}" }}</code> — URL to featured WebP</li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="card-title">Blog Tokens</h6>
          <ul class="small">
            <li><code>{{ "{{blog:categories}}" }}</code> — Unordered list of all blog categories, each linked to the blog container page</li>
            <li><code>{{ "{{blog:latest}}" }}</code> — Unordered list of all published blog posts ordered by date (newest first), with featured images (if available), title, excerpt, and links to /blog/slug.html</li>
            <li><code>{{ "{{blog:category:[123]}}" }}</code> or <code>{{ "{{blog:category:123}}" }}</code> — Unordered list of blog posts in category ID 123</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-3">
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="card-title">Config Tokens</h6>
          <ul class="small">
            <li><code>{{ "{{config:base_url}}" }}</code> — Site base URL from settings (e.g., https://example.com)</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <h3 class="mt-4">Conditionals</h3>
  <p>You can conditionally render content based on simple page fields:</p>
  <div class="alert alert-light small">
    <pre class="mb-0"><code>{{ "{{if page:featured}}" }}
&lt;img src="{{ "{{page:featured:webp}}" }}" alt="{{ "{{page:title}}" }}"&gt;
{{ "{{/if}}" }}</code></pre>
    <ul class="mb-0">
      <li><code>{{ "{{if page:featured}}" }}</code> — True when a featured image exists</li>
      <li><code>{{ "{{if page:excerpt}}" }}</code> — True when an excerpt is set</li>
      <li><code>{{ "{{if page:title}}" }}</code> — True when title is non-empty</li>
    </ul>
  </div>

  <div class="alert alert-info mt-3">
    <h6><strong>Features:</strong></h6>
    <ul class="mb-0">
      <li><strong>Type Badges</strong>: Visual indicators show parameter types next to labels</li>
      <li><strong>Syntax Highlighting</strong>: Code parameters get full CodeMirror integration</li>
      <li><strong>Rich Text Editing</strong>: WYSIWYG parameters use Quill editor with full formatting toolbar</li>
      <li><strong>Backward Compatible</strong>: Existing parameters without types default to plain text</li>
    </ul>
  </div>

  <h3 class="mt-4">Blog Latest Shortcode Example</h3>
  <p>The <code>{{ "{{blog:latest}}" }}</code> shortcode generates a complete unordered list of all published blog posts with featured images when available:</p>
  
  <div class="alert alert-light">
    <h6><strong>Generated HTML Structure:</strong></h6>
    <pre class="mb-0"><code>&lt;ul class="blog-latest"&gt;
  &lt;li class="blog-latest-item"&gt;
    &lt;img src="https://example.com/blog/content/featured-abc123.png" alt="My First Post" class="blog-featured-image" style="max-width: 200px; height: auto; margin-bottom: 8px;"&gt;
    &lt;a href="/blog/my-first-post.html"&gt;My First Post&lt;/a&gt;
    &lt;div class="excerpt"&gt;This is the excerpt for my first blog post...&lt;/div&gt;
  &lt;/li&gt;
  &lt;li class="blog-latest-item"&gt;
    &lt;a href="/blog/another-post.html"&gt;Another Post&lt;/a&gt;
    &lt;div class="excerpt"&gt;Another excerpt here...&lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;</code></pre>
  </div>

  <div class="alert alert-success">
    <h6><strong>Features:</strong></h6>
    <ul class="mb-0">
      <li><strong>Ordered by Date</strong>: Posts are sorted by creation date (newest first)</li>
      <li><strong>Published Only</strong>: Only shows published blog posts</li>
      <li><strong>Featured Images</strong>: Includes featured images when available (PNG preferred, WebP fallback)</li>
      <li><strong>Complete Links</strong>: Each post links to <code>/blog/slug.html</code></li>
      <li><strong>Excerpts Included</strong>: Shows post excerpts when available</li>
      <li><strong>CSS Classes</strong>: Includes <code>blog-latest</code>, <code>blog-latest-item</code>, and <code>blog-featured-image</code> classes for styling</li>
    </ul>
  </div>

  <h3 class="mt-4">Config Base URL Shortcode</h3>
  <p>The <code>{{ "{{config:base_url}}" }}</code> shortcode provides the site's base URL from the settings:</p>
  
  <div class="alert alert-light">
    <h6><strong>Usage Examples:</strong></h6>
    <pre class="mb-0"><code>&lt;link rel="canonical" href="{{ "{{config:base_url}}" }}/{{ "{{page:slug}}" }}.html"&gt;
&lt;meta property="og:url" content="{{ "{{config:base_url}}" }}/{{ "{{page:slug}}" }}.html"&gt;
&lt;a href="{{ "{{config:base_url}}" }}/contact.html"&gt;Contact Us&lt;/a&gt;</code></pre>
  </div>

  <div class="alert alert-info">
    <h6><strong>Configuration:</strong></h6>
    <ul class="mb-0">
      <li><strong>Default Value</strong>: <code>http://localhost:5000</code></li>
      <li><strong>Settings Location</strong>: Admin → Settings → Base URL</li>
      <li><strong>Use Cases</strong>: Canonical URLs, Open Graph tags, absolute links, sitemaps</li>
      <li><strong>Production</strong>: Set to your actual domain (e.g., <code>https://example.com</code>)</li>
    </ul>
  </div>

  <h3 class="mt-4">Page Duplication</h3>
  <p>Easily create copies of existing pages with all content and templates:</p>
  <ul>
    <li>Click the <strong>"Duplicate"</strong> button next to any page in the page list</li>
    <li>Confirm the duplication in the dialog</li>
    <li>The new page will have the same content with "(Copy)" added to the title</li>
    <li>Slug will be automatically adjusted to ensure uniqueness</li>
    <li>All duplicated pages are created as drafts (unpublished)</li>
    <li>You'll be automatically redirected to edit the new duplicated page</li>
  </ul>

  <h3 class="mt-4">System Block Management</h3>
  <p>System blocks (HTML structure, meta tags, etc.) are hidden by default for a cleaner editing experience:</p>
  <ul>
    <li><strong>Toggle Button</strong>: Show/hide system blocks with the button in the page editor header</li>
    <li><strong>Visual Feedback</strong>: Button changes icon and color based on current state</li>
    <li><strong>Settings Control</strong>: Configure default behavior in the Settings page</li>
    <li><strong>Per-User Preference</strong>: Each admin can set their preferred default</li>
  </ul>

  <h3 class="mt-4">Import/Export</h3>
  <div class="row">
    <div class="col-md-6">
      <h5>Export Pages</h5>
      <ul>
        <li><strong>Export All</strong>: Download all pages as JSON</li>
        <li><strong>Selective Export</strong>: Choose specific pages using checkboxes</li>
        <li><strong>Complete Data</strong>: Includes all templates, content, and parameters</li>
        <li><strong>Smart Selection</strong>: Use master checkbox to select/deselect all</li>
      </ul>
    </div>
    <div class="col-md-6">
      <h5>Import Pages</h5>
      <ul>
        <li><strong>JSON Import</strong>: Upload exported JSON files</li>
        <li><strong>Conflict Resolution</strong>: Option to overwrite existing pages</li>
        <li><strong>Template Validation</strong>: Checks if referenced templates exist</li>
        <li><strong>Bulk Operations</strong>: Import multiple pages at once</li>
      </ul>
    </div>
  </div>

  <div class="alert alert-success mt-4">
    <h5><i class="bi bi-lightbulb"></i> Pro Tips</h5>
    <ul class="mb-0">
      <li><strong>Use CMS indentation</strong> to organize complex page structures visually</li>
      <li><strong>Code parameters</strong> are perfect for custom HTML, CSS, or JavaScript</li>
      <li><strong>WYSIWYG parameters</strong> provide rich text editing with Quill's powerful toolbar</li>
      <li><strong>Duplicate pages</strong> to quickly create similar pages with slight variations</li>
      <li><strong>Export before major changes</strong> to keep backups of your work</li>
      <li><strong>System blocks</strong> control the overall page structure - hide them to focus on content</li>
    </ul>
  </div>

  <p class="text-muted mt-4">Tip: All admin UI is Bootstrap-based; public output depends entirely on your templates.</p>
</div>
{% endblock %}


